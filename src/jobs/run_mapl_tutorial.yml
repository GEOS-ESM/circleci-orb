description: >
  Run MAPL Tutorial

parameters:
  repo:
    type: string
    default: MAPL
    description: "Name of the repo to act upon"
  compiler:
    type: enum
    default: ifort
    description: "Compiler to use"
    enum: ["ifort", "gfortran"]
  resource_class:
    type: enum
    default: medium
    description: "Resource class to use"
    enum: ["medium", "large", "xlarge"]
  baselibs_version:
    type: string
    default: v7.5.0
    description: "Baselibs version to use"
  gcc_version:
    description: "Version of GNU compiler to use"
    default: 12.1.0
    type: string
  openmpi_version:
    description: "Version of Open MPI to use"
    default: 4.1.4
    type: string
  intel_version:
    description: "Version of Intel compiler to use"
    default: 2022.1.0
    type: string
  intelmpi_version:
    description: "Version of Intel MPI to use"
    default: 2021.6.0
    type: string
  workspace_root:
    description: "Workspace root"
    type: string
    default: workspace
  tutorial_name:
    description: "Name of tutorial"
    type: string

executor:
  name: << parameters.compiler >>
  resource_class: << parameters.resource_class >>
  baselibs_version: << parameters.baselibs_version >>
  gcc_version: << parameters.gcc_version >>
  openmpi_version: << parameters.openmpi_version >>
  intel_version: << parameters.intel_version >>
  intelmpi_version: << parameters.intelmpi_version >>

working_directory: /root/project

steps:
  - attach_workspace:
      at: << parameters.workspace_root >>
  - run_tutorial:
      repo: << parameters.repo >>
      workspace_root: << parameters.workspace_root >>
      tutorial_name: << parameters.tutorial_name >>
  - compress_artifacts
  - store_artifacts:
      path: /logfiles
