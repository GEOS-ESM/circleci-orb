description: >
  GEOS-ESM gfortran docker executor with boundary conditions

parameters:
  resource_class:
    description: "Resource class to use"
    default: large
    type: string
  baselibs_version:
    description: "Version of Baselibs to use"
    default: v7.5.0
    type: string
  bcs_version:
    description: "Version of boundary conditions to use"
    default: v10.22.5
    type: string
  gcc_version:
    description: "Version of GNU compiler to use"
    default: 12.1.0
    type: string
  openmpi_version:
    description: "Version of Open MPI to use"
    default: 4.1.4
    type: string

docker:
  - image: gmao/ubuntu20-geos-env-bcs:<< parameters.baselibs_version >>-openmpi_<< parameters.openmpi_version >>-gcc_<< parameters.gcc_version >>-bcs_<< parameters.bcs_version >>
    auth:
      username: $DOCKERHUB_USER
      password: $DOCKERHUB_AUTH_TOKEN

environment:
  OMPI_ALLOW_RUN_AS_ROOT: 1
  OMPI_ALLOW_RUN_AS_ROOT_CONFIRM: 1
  OMPI_MCA_btl_vader_single_copy_mechanism: none
  MPIEXEC_PREFLAGS: --oversubscribe

resource_class: << parameters.resource_class >>
